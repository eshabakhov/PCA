<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.4.xsd">


    <changeSet id="study/1.0/17-02-2023/1" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            CREATE SCHEMA IF NOT EXISTS phone_calls;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/26-05-2023/2" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            CREATE TABLE phone_calls.call(
                id bigserial primary key,
                abonent_id bigint,
                city_id bigint,
                datetime timestamp,
                minutes integer
            );
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/26-05-2023/3" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            CREATE TABLE phone_calls.abonent(
                id bigserial primary key,
                phone_number varchar(15),
                inn varchar(50),
                address varchar(100)
            );
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/26-05-2023/4" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            CREATE TABLE phone_calls.city(
                id bigserial primary key,
                night_rate numeric,
                day_rate numeric
            );
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/26-05-2023/5" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            CREATE TABLE phone_calls.user(
                id bigserial primary key ,
                login varchar(20),
                password_hash varchar(50),
                name varchar(20),
                surname varchar(20),
                patronimyc varchar(20)
            );
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/01-06-2023/1" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            ALTER TABLE phone_calls.user ADD COLUMN is_admin boolean;
            ALTER TABLE phone_calls.user RENAME COLUMN patronimyc TO patronymic;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/01-06-2023/2" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            ALTER TABLE phone_calls.user ALTER COLUMN password_hash TYPE varchar;
            INSERT INTO phone_calls.user (login, password_hash) values
                -- user user
                ('user', '$2a$12$fowbQNbIqCa14/2ZM4yYLOVABUIKEQ9I9G5ODf432trmIyQNKAONq'),
                -- admin admin и что вы мне сделаете?
                ('admin', '$2a$12$PLvCPM4K4yDPTATe3l7yQue5H7tPbqtNQgbvOWHqt48cQ32GmSl.6')
            ]]>
        </sql>
    </changeSet>

    <changeSet id="20230607-01" author="murzin" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            CREATE TABLE phone_calls.audit
            (
                id       bigserial primary key,
                username varchar(64),
                endpoint varchar(256),
                method   varchar(8),
                datetime timestamp
            );
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/02-06-2023/1" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            ALTER TABLE phone_calls.city ADD COLUMN name varchar;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/07-06-2023/1" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            ALTER TABLE phone_calls.user ADD COLUMN attempts int;
            ALTER TABLE phone_calls.user ADD COLUMN last_attempts timestamp;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="study/1.0/08-06-2023/1" author="ivan_sych" logicalFilePath="set-1.xml">
        <sql>
            <![CDATA[
            ALTER TABLE phone_calls.user DROP COLUMN attempts;
            ALTER TABLE phone_calls.user DROP COLUMN last_attempts;
            ALTER TABLE phone_calls.user ADD COLUMN is_locked boolean;
            ALTER TABLE phone_calls.user ADD COLUMN datetime_of_lock timestamp;
            ]]>
        </sql>
    </changeSet>

</databaseChangeLog>